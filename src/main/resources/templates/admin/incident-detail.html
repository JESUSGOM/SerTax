<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" th:replace="~{admin/layout :: layout(~{::title}, ~{::div.content-fragment})}">
<head>
    <title>Detalle de Incidencia</title>
    <style>
        .detail-grid { display: grid; grid-template-columns: 150px 1fr; gap: 10px 20px; }
        .detail-grid dt { font-weight: bold; }
    </style>
</head>
<body>
<div class="content-fragment">
    <div th:if="${successMessage}" style="color: green; margin-bottom: 15px;" th:text="${successMessage}"></div>
    <div th:if="${errorMessage}" style="color: red; margin-bottom: 15px;" th:text="${errorMessage}"></div>

    <h3>Detalles de la Incidencia</h3>
    <dl class="detail-grid">
        <dt>ID Incidencia:</dt>
        <dd th:text="${incident.incidentId}">1</dd>

        <dt>Tipo:</dt>
        <dd th:text="${incident.type}">Queja</dd>

        <dt>Estado Actual:</dt>
        <dd th:text="${incident.status}" style="font-weight: bold;"></dd>

        <dt>Fecha:</dt>
        <dd th:text="${#temporals.format(incident.timestamp, 'dd-MM-yyyy HH:mm')}"></dd>

        <dt>Descripción:</dt>
        <dd th:text="${incident.description}" style="white-space: pre-wrap;"></dd>
    </dl>

    <h3 style="margin-top: 30px;">Información del Reporte</h3>
    <dl class="detail-grid">
        <dt>Reportado por:</dt>
        <dd th:text="${incident.reporter.name} + ' (' + ${incident.reporter.reporterType} + ')'"></dd>

        <dt>ID Viaje Asociado:</dt>
        <dd th:text="${incident.trip?.tripId ?: 'N/A'}"></dd>

        <dt th:if="${incident.trip}">Recogida:</dt>
        <dd th:if="${incident.trip}" th:text="${incident.trip.pickupAddress}"></dd>
    </dl>

    <h3 style="margin-top: 30px;">Gestionar Incidencia</h3>
    <form th:action="@{/admin/incidents/update-status/{id}(id=${incident.incidentId})}" method="post">
        <label for="status">Cambiar Estado a:</label>
        <select id="status" name="status">
            <option th:each="stat : ${statuses}"
                    th:value="${stat}"
                    th:text="${stat}"
                    th:selected="${stat.toString() == incident.status}">
            </option>
        </select>
        <button type="submit">Actualizar Estado</button>
    </form>

    <div style="margin-top: 30px;">
        <a th:href="@{/admin/incidents}">Volver a la lista de incidencias</a>
    </div>
</div>
</body>
</html>